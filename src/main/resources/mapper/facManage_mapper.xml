<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC   "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd"
>

<mapper namespace="com.tmtm.fac.FacManageDAO">


	<select id="facList" resultType="facManage">
		SELECT * FROM fac f ,fac_state fs,file f2
			WHERE f.fac_state !=3
			AND f.fac_state = fs.fac_state_num 
			AND f2.all_num = f.fac_num
			AND f2.file_sort_num = f2.file_sort_num 
	</select>
	
	<select id="bookList" resultType="facManage">
		SELECT book_num FROM fac_book
	</select>
	
	<select id="empChoice" resultType="facManage">
		SELECT * FROM employee e, authority a 
			WHERE e.emp_num = a.emp_num 
			AND a.auth_num = 6
	</select>
	
	
	<insert id="register" parameterType="facManage" useGeneratedKeys="true"
	keyColumn="fac_num" keyProperty="fac_num">
		INSERT INTO fac (fac_name, emp_num, fac_state, color) VALUES (#{fac_name}, #{emp_num},1, #{color})
	</insert>
	
	<insert id="fileInsert" parameterType="facManage">
		INSERT INTO file(all_num, file_sort_num, ori_filename, new_filename) 
			VALUES (#{all_num}, 3, #{ori_filename}, #{new_filename})
	</insert>
	
	<update id="update" parameterType="facManage">
		UPDATE fac  
			SET 
			fac_name  = #{fac_name},
			emp_num  = #{emp_num},
			color = #{color}
			WHERE fac_num  = #{fac_num}
	</update>

	<update id="fileUpdate" parameterType="facManage">
		UPDATE file  
			SET 
			ori_filename  = #{ori_filename},
			new_filename  = #{new_filename}
			WHERE all_num  = #{all_num}
	</update>
	
	<update id="delete">
		UPDATE fac
			SET
			fac_state = 3
			WHERE 
			fac_num = #{param1}
			
	</update>

	












</mapper>